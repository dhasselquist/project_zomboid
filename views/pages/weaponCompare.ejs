<html>
<head>
<% include ../partials/head %>
<link rel="stylesheet" href="/content/weaponCompare.css">
</head>
<body ng-app="zomboid" ng-cloak>
<% include ../partials/header %>
        <div class="container-fluid" ng-controller="main">
	<div class="row">
        <h2>Choose two items to compare:</h2>
	</div>
        <div>
		<div class="row">
			<div class="col-sm-12">
                Item 1: <select ng-model="data.weaponOne" ng-change="checkInputs()" ng-options="x.DisplayName for x in weapons">
                        <option value="">- Weapon -</option>
		</select></div></div>
                Item 2: <select ng-model="data.weaponTwo" ng-change="checkInputs()" ng-options="x.DisplayName for x in weapons">
                        <option value="">- Weapon -</option>
                </select> <br/>
 <button type="button" style="btn" ng-click="switch()">Switch</button>
        </div>
	<div ng-show="showTable">
	<table class="table table-striped table-hover table-condensed">
	<thead>
	<tr>
	<th>Stat</th>
	<th>{{data.weaponOne.DisplayName}} </th>
	<th>Result</th>
	<th>{{data.weaponTwo.DisplayName}}</th>
	</tr>
	</thead>
	<tbody>
	<tr ng-repeat="metric in metricResults | orderBy:advantagesFirst">
	<td style="text-align:left;">{{metric.displayValue}}</td>
	<td>{{metric.weaponOneVal}}</td>
	<td class={{metric.result}}></td>
	<td>{{metric.weaponTwoVal}}</td>
	</tr>
	</tbody>
	</div>
	</table>
<script>
  angular.module('zomboid', [])
  .controller('main', ['$scope', '$http', function($scope, $http) {
    $scope.data = {}, $scope.showTable = false, $scope.metricResults = [], $scope.weapons = [];
    $scope.advantagesFirst = function(card) {
      if (card.result == "Advantage") return 0;
      else if (card.result == "Equal") return 1;
      else return 2;
    }
    $scope.switch = function() {
      [$scope.data.weaponOne, $scope.data.weaponTwo] = [$scope.data.weaponTwo, $scope.data.weaponOne];
      $scope.weaponAdvantages();
    }
    $http.get('/getWeapons')
      .then(function(response) {
        $scope.weapons = response.data;
      });
    $scope.checkInputs = function() {
      if ($scope.data.weaponOne != undefined && $scope.data.weaponTwo != undefined) {
        $scope.weaponAdvantages();
        $scope.showTable = true;
      } else $scope.showTable = false;
    }
    $scope.weaponAdvantages = function() {
      $scope.metrics = [{"metric":"MaxDamage","displayName":"Maximum Damage","advantage":">"},
	{"metric":"MinDamage","displayName":"Minimum Damage","advantage":">"},
	{"metric":"CriticalChance","displayName":"Critical Chance","advantage":">"},
	{"metric":"Weight","displayName":"Weight","advantage":"<"},
	{"metric":"ConditionMax","displayName":"Maximum Durability","advantage":">"},
	{"metric":"ConditionLowerChanceOneIn","displayName":"Odds of Breaking (lower is more often)","advantage": ">"},
	{"metric":"MaxRange","displayName":"Maximum Range","advantage":">"},
	{"metric":"SwingTime","displayName":"Weapon Speed","advantage":"<"}];
      $scope.metricResults = [];
      var a = $scope.data.weaponOne;
      var b = $scope.data.weaponTwo;
      for (var i = 0; i < $scope.metrics.length; i++) {
        var metricInstance = {};
        metricInstance.metric = $scope.metrics[i].metric;
        metricInstance.displayValue = $scope.metrics[i].displayName;
        metricInstance.weaponOneVal = a[$scope.metrics[i].metric];
        metricInstance.weaponTwoVal = b[$scope.metrics[i].metric];
        if (((a[$scope.metrics[i].metric] - b[$scope.metrics[i].metric]) > 0) && $scope.metrics[i].advantage == ">")
          metricInstance.result = "Advantage";
        else if (((a[$scope.metrics[i].metric] - b[$scope.metrics[i].metric]) < 0) && $scope.metrics[i].advantage == "<")
          metricInstance.result = "Advantage";
        else if (a[$scope.metrics[i].metric] == b[$scope.metrics[i].metric])
          metricInstance.result = "Equal";
        else
          metricInstance.result = "Disadvantage";

        $scope.metricResults.push(metricInstance);
      }
      return;
    }
  }]); </script>
</body>
</html>
